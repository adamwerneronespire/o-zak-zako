FUNCTION-POOL /ZAK/FUNCTIONS.               "MESSAGE-ID ..

INCLUDE /ZAK/COMMON_STRUCT.

DATA: I_/ZAK/BEVALLALV TYPE STANDARD TABLE OF /ZAK/BEVALLALV
                                                       INITIAL SIZE 0,
      I_SUM             TYPE STANDARD TABLE OF /ZAK/BEVALLO         INITIAL SIZE 0.
*&---------------------------------------------------------------------*
*& Munkaterület  (W_XXX..)                                             *
*&---------------------------------------------------------------------*
DATA:
  W_SUM TYPE /ZAK/BEVALLO,
  W_X   TYPE /ZAK/BEVALLB.
*&---------------------------------------------------------------------*
*& PROGRAM VÁLTOZÓK                                                    *
*&---------------------------------------------------------------------*
DATA: V_TABIX    LIKE SY-TABIX,
      V_SUBRC    LIKE SY-SUBRC,
      V_INDEX(3) TYPE N.
*----------------------------------------------------------------------*
RANGES: R_MONAT FOR /ZAK/ANALITIKA-MONAT.
*++2065 #04.
DATA V_INF_COUNT TYPE SYTABIX.
*--2065 #04.
*XML letöltéshez változók
*Konstans értékek
* HR.... XML 0 űrlap
CONSTANTS C_XFORM0 LIKE T512P-FORML VALUE 'HAX0'.
* HR.... XML 1 űrlap
CONSTANTS C_XFORM1 LIKE T512P-FORML VALUE 'HAX1'.
* HR.... XML 2 űrlap
CONSTANTS C_XFORM2 LIKE T512P-FORML VALUE 'HAX2'.
* HR.... XML 3 űrlap
CONSTANTS C_XFORM3 LIKE T512P-FORML VALUE 'HAX3'.
* HR.... XML 4 űrlap
CONSTANTS C_XFORM4 LIKE T512P-FORML VALUE 'HAX4'.

*++BG 2006/09/29
*APEH új formulárok miatt
*++0908/2 2009.08.04 BG
*CONSTANTS C_XHEAD LIKE T5HVX-BLOKK_ID VALUE 'XHEAD'.
*CONSTANTS C_XTAIL LIKE T5HVX-BLOKK_ID VALUE 'XTAIL'.
*CONSTANTS C_NYBEG LIKE T5HVX-BLOKK_ID VALUE 'NYBEG'.
*CONSTANTS C_VHEAD LIKE T5HVX-BLOKK_ID VALUE 'VHEAD'.
*CONSTANTS C_NYEND LIKE T5HVX-BLOKK_ID VALUE 'NYEND'.
*CONSTANTS C_EHEAD LIKE T5HVX-BLOKK_ID VALUE 'EHEAD'.
CONSTANTS C_XHEAD LIKE /ZAK/T5HVX-BLOKK_ID VALUE 'XHEAD'.
CONSTANTS C_XTAIL LIKE /ZAK/T5HVX-BLOKK_ID VALUE 'XTAIL'.
CONSTANTS C_NYBEG LIKE /ZAK/T5HVX-BLOKK_ID VALUE 'NYBEG'.
CONSTANTS C_VHEAD LIKE /ZAK/T5HVX-BLOKK_ID VALUE 'VHEAD'.
CONSTANTS C_NYEND LIKE /ZAK/T5HVX-BLOKK_ID VALUE 'NYEND'.
CONSTANTS C_EHEAD LIKE /ZAK/T5HVX-BLOKK_ID VALUE 'EHEAD'.
*--0908/2 2009.08.04 BG
*--BG 2006/09/29
* XML formulár, XML header
DATA: BEGIN OF GT_XFORM0 OCCURS 50,
        LINDA LIKE T512P-LINDA,
      END OF GT_XFORM0.

* XML formulár, XML footer
DATA: BEGIN OF GT_XFORM1 OCCURS 50,
        LINDA LIKE T512P-LINDA,
      END OF GT_XFORM1.

* XML formulár, 0608A nyomtatvány header
DATA: BEGIN OF GT_XFORM2 OCCURS 50,
        LINDA LIKE T512P-LINDA,
      END OF GT_XFORM2.

* XML formulár, nyomtatvány footer
DATA: BEGIN OF GT_XFORM3 OCCURS 50,
        LINDA LIKE T512P-LINDA,
      END OF GT_XFORM3.

* XML formulár, 0608M nyomtatvány header
DATA: BEGIN OF GT_XFORM4 OCCURS 50,
        LINDA LIKE T512P-LINDA,
      END OF GT_XFORM4.

* XML adatfájl típusa
TYPES: TY_XML_LINE   LIKE T512P-LINDA,
       TTY_XML_TABLE TYPE TABLE OF TY_XML_LINE.

* változó kezdetének és végének jelzése az űrlapokon
*++BG 2006/09/29
*CONSTANTS: C_VAR_MARKER(1) TYPE C VALUE '&'.
CONSTANTS: C_VAR_MARKER(1) TYPE C VALUE '$'.
*--BG 2006/09/29

*++BG 2006/05/29
* SZJA bevallás adóazonosító lapszám meghatározáshoz
TYPES: BEGIN OF T_MLAP,
         ADOAZON  LIKE /ZAK/BEVALLALV-ADOAZON,
         ABEVAZ   LIKE /ZAK/BEVALLALV-ABEVAZ,
         LAPSZ(4),
       END OF T_MLAP.


DATA I_MLAP TYPE HASHED TABLE OF T_MLAP
                             WITH UNIQUE KEY ADOAZON
                                             ABEVAZ
                                             LAPSZ
                             INITIAL SIZE 0.
DATA W_MLAP TYPE T_MLAP.

*++0908 2009.01.27 BG
TYPES: BEGIN OF T_NYLAP,
         ADOAZON LIKE /ZAK/BEVALLALV-ADOAZON,
       END OF T_NYLAP.

DATA I_NYLAP TYPE HASHED TABLE OF T_NYLAP
                             WITH UNIQUE KEY ADOAZON
                             INITIAL SIZE 0.
DATA W_NYLAP TYPE T_NYLAP.
*--0908 2009.01.27 BG


*MAKRO definiálás range feltöltéshez
DEFINE M_DEF.
  MOVE: &2      TO &1-sign,
        &3      TO &1-option,
        &4      TO &1-low,
        &5      TO &1-high.
  COLLECT &1.
END-OF-DEFINITION.
*--BG 2006/05/29
*++1365 2013.01.22 Balázs Gábor (Ness)
*Konverzió
DEFINE M_RUN_CONV.
  CALL METHOD cl_reca_ddic_services=>do_struct_conv_exit
*      EXPORTING
*        id_convexit        =
*        if_only_if_defined = ABAP_TRUE
*        if_output          = ABAP_FALSE
    CHANGING
      cs_struct          = &1
    EXCEPTIONS
      error              = 1
      OTHERS             = 2
          .
END-OF-DEFINITION.

* Csoportok felépítése
TYPES: BEGIN OF T_SZLA_GROUP,
         SZAMLASZA TYPE /ZAK/SZAMLASZA,
         SZAMLASZ  TYPE /ZAK/SZAMLASZ,
         POSNN     TYPE POSNR_NACH,
         VBTYP     TYPE VBTYP_N,     "#EC CI_USAGE_OK[2198647]
         SZLATIP   TYPE /ZAK/SZLATIP,
       END OF T_SZLA_GROUP.
DATA I_SZLA_GROUP TYPE STANDARD TABLE OF T_SZLA_GROUP.

DEFINE M_SET_COMWA.
  CLEAR ls_comwa.
  MOVE sy-mandt TO ls_comwa-mandt.
  MOVE &1 TO ls_comwa-vbeln.
  MOVE &2 TO ls_comwa-posnr.
*   Konverzió végrehajtása
  m_run_conv ls_comwa.
END-OF-DEFINITION.


DEFINE M_CALL_FLOW_INFORMATION.
*++1365 #7.
* REFRESH LI_VBFA_TAB.
  REFRESH &1.
*--1365 #7.
  CLEAR &2.
  CALL FUNCTION 'RV_ORDER_FLOW_INFORMATION'
    EXPORTING
     aufbereitung        = '2'
*       BELEGTYP            = ' '
      comwa               = ls_comwa
     nachfolger          = 'X'
     n_stufen            = '50'
     vorgaenger          = 'X'
     v_stufen            = '50'
*     IMPORTING
*       BELEGTYP_BACK       =
    TABLES
      vbfa_tab            = &1
    EXCEPTIONS
      no_vbfa             = 1
      no_vbuk_found       = 2
      OTHERS              = 3
            .
  IF sy-subrc <> 0.
    MOVE sy-subrc TO &2.
  ENDIF.
END-OF-DEFINITION.

DATA V_SZAMLASZA TYPE /ZAK/SZAMLASZA.
*--1365 2013.01.22 Balázs Gábor (Ness)

*++BG 2006.09.15
* ÚJ SZJA bevallás miatt a 0608-at meg kell különböztetni
CONSTANTS: C_0608 TYPE /ZAK/BTYPE VALUE '0608'.
*--BG 2006.09.15

*++BG 2007.02.01
CONSTANTS: C_06082 TYPE /ZAK/BTYPE VALUE '06082'.
CONSTANTS: C_0708  TYPE /ZAK/BTYPE VALUE '0708'.
*--BG 2007.02.01

*++ BG 2008.01.28
CONSTANTS: C_0808  TYPE /ZAK/BTYPE VALUE '0808'.
*-- BG 2008.01.28
*++0908 2009.01.20 BG
CONSTANTS: C_0908  TYPE /ZAK/BTYPE VALUE '0908'.
*--0908 2009.01.20 BG
*++0965 2009.02.02 BG
CONSTANTS: C_0865  TYPE /ZAK/BTYPE VALUE '0865'.
CONSTANTS: C_0965  TYPE /ZAK/BTYPE VALUE '0965'.
*--0965 2009.02.02 BG
*++0005 2010.01.22 BG
CONSTANTS: C_1065  TYPE /ZAK/BTYPE VALUE '1065'.
*--1065 2010.01.27 BG
*++1165 2011.02.07 BG
CONSTANTS: C_1165  TYPE /ZAK/BTYPE VALUE '1165'.
*--1165 2011.02.07 BG
*++1265 2012.01.31 BG
CONSTANTS: C_1265  TYPE /ZAK/BTYPE VALUE '1265'.
*--1265 2012.01.31 BG
*++1365 2013.01.10 Balázs Gábor (Ness)
CONSTANTS: C_1365  TYPE /ZAK/BTYPE VALUE '1365'.
*--1365 2013.01.10 Balázs Gábor (Ness)
*++1465 #01. 2013.02.04 Balázs Gábor (Ness)
CONSTANTS: C_1465  TYPE /ZAK/BTYPE VALUE '1465'.
*--1465 #01. 2013.02.04 Balázs Gábor (Ness)
*++1565 #01. 2015.01.26
CONSTANTS: C_1565  TYPE /ZAK/BTYPE VALUE '1565'.
*--1565 #01. 2015.01.26
*++1665 #01. 2015.02.02
CONSTANTS: C_1665  TYPE /ZAK/BTYPE VALUE '1665'.
*--1665 #01. 2015.02.02
*++1765 #01. 2017.01.31
CONSTANTS: C_1765  TYPE /ZAK/BTYPE VALUE '1765'.
*--1765 #01. 2017.01.31
*++1865 #01. 2018.01.30
CONSTANTS: C_1865  TYPE /ZAK/BTYPE VALUE '1865'.
*--1865 #01. 2018.01.30
*++1965 #01.
CONSTANTS: C_1965  TYPE /ZAK/BTYPE VALUE '1965'.
*--1965 #01.
*++2065 #01.
CONSTANTS: C_2065  TYPE /ZAK/BTYPE VALUE '2065'.
*--2065 #01.
*++2165 #01.
CONSTANTS: C_2165  TYPE /ZAK/BTYPE VALUE '2165'.
*--2165 #01.
*++2265 #01.
CONSTANTS: C_2265  TYPE /ZAK/BTYPE VALUE '2265'.
*--2265 #01.
*++2365 #01.
CONSTANTS: C_2365  TYPE /ZAK/BTYPE VALUE '2365'.
*--2365 #01.
*++2465 #01.
CONSTANTS: C_2465  TYPE /ZAK/BTYPE VALUE '2465'.
*--2465 #01.
*++2565 #01.
CONSTANTS: C_2565  TYPE /ZAK/BTYPE VALUE '2565'.
*--2565 #01.
*++1008 2010.01.20 BG
CONSTANTS: C_1008  TYPE /ZAK/BTYPE VALUE '1008'.
*--1008 2010.01.20 BG
*++1108 2010.01.24 BG
CONSTANTS: C_1108  TYPE /ZAK/BTYPE VALUE '1108'.
*--1108 2010.01.24 BG
*++BG 2008.04.02
*ONYB bevallások
CONSTANTS: C_0761   TYPE /ZAK/BTYPE VALUE '0761'.
CONSTANTS: C_08A60  TYPE /ZAK/BTYPE VALUE '08A60'.
*--BG 2008.04.02
*++09A60 2009.04.02 BG
CONSTANTS: C_09A60  TYPE /ZAK/BTYPE VALUE '09A60'.
*--09A60 2009.04.02 BG
*++10A60 2010.02.11 RN
CONSTANTS: C_10A60  TYPE /ZAK/BTYPE VALUE '10A60'.
*--10A60 2010.02.11 RN
*++11A60 2011.02.07 BG
CONSTANTS: C_11A60  TYPE /ZAK/BTYPE VALUE '11A60'.
*--11A60 2011.02.07 BG
*++12A60 2012.02.06 BG
CONSTANTS: C_12A60  TYPE /ZAK/BTYPE VALUE '12A60'.
*--12A60 2012.02.06 BG
*++13A60 2013.01.28 BG
CONSTANTS: C_13A60  TYPE /ZAK/BTYPE VALUE '13A60'.
*--13A60 2012.01.28 BG
*++14A60 #01. 2014.02.04 Balázs Gábor (Ness)
CONSTANTS: C_14A60  TYPE /ZAK/BTYPE VALUE '14A60'.
*--14A60 #01. 2014.02.04 Balázs Gábor (Ness)
*++15A60 #01. 2015.01.26
CONSTANTS: C_15A60  TYPE /ZAK/BTYPE VALUE '15A60'.
*--15A60 #01. 2015.01.26
*++16A60 #01. 2015.02.02
CONSTANTS: C_16A60  TYPE /ZAK/BTYPE VALUE '16A60'.
*--16A60 #01. 2015.02.02
*++17A60 #01. 2017.01.31
CONSTANTS: C_17A60  TYPE /ZAK/BTYPE VALUE '17A60'.
*--17A60 #01. 2017.01.31
*++18A60 #01. 2018.01.30
CONSTANTS: C_18A60  TYPE /ZAK/BTYPE VALUE '18A60'.
*--18A60 #01. 2018.01.30
*++19A60 #01.
CONSTANTS: C_19A60  TYPE /ZAK/BTYPE VALUE '19A60'.
*--19A60 #01.
*++20A60 #01.
CONSTANTS: C_20A60  TYPE /ZAK/BTYPE VALUE '20A60'.
*--20A60 #01.
*++21A60 #01.
CONSTANTS: C_21A60  TYPE /ZAK/BTYPE VALUE '21A60'.
*--21A60 #01.
*++22A60 #01.
CONSTANTS: C_22A60  TYPE /ZAK/BTYPE VALUE '22A60'.
*--22A60 #01.
*++23A60 #01.
CONSTANTS: C_23A60  TYPE /ZAK/BTYPE VALUE '23A60'.
*--23A60 #01.
*++24A60 #01.
CONSTANTS: C_24A60  TYPE /ZAK/BTYPE VALUE '24A60'.
*--24A60 #01.
*++25A60 #01.
CONSTANTS: C_25A60  TYPE /ZAK/BTYPE VALUE '25A60'.
*--25A60 #01.
*++BG 2012.01.17
CONSTANTS: C_11K79  TYPE /ZAK/BTYPE VALUE '11K79'.
*--BG 2012.01.17
*++12K79 2013.01.23
CONSTANTS: C_12K79  TYPE /ZAK/BTYPE VALUE '12K79'.
*--12K79 2013.01.23
*++13K79 2014.01.27
CONSTANTS: C_13K79  TYPE /ZAK/BTYPE VALUE '13K79'.
*--13K79 2014.01.27
*++19K79 #01.
CONSTANTS: C_19K79  TYPE /ZAK/BTYPE VALUE '19K79'.
*--19K79 #01.
*++20K79 #01
CONSTANTS: C_20K79  TYPE /ZAK/BTYPE VALUE '20K79'.
*--20K79 #01
*++1208 2012.02.01 BG
CONSTANTS: C_1208  TYPE /ZAK/BTYPE VALUE '1208'.
*--1208 2012.02.01 BG
*++1308 2013.02.05 BG
CONSTANTS: C_1308  TYPE /ZAK/BTYPE VALUE '1308'.
*--1308 2013.02.05 BG
*++1408 2014.01.29 BG
CONSTANTS: C_1408  TYPE /ZAK/BTYPE VALUE '1408'.
*--1408 2014.01.29 BG
*++1508 #01. 2015.02.02
CONSTANTS: C_1508  TYPE /ZAK/BTYPE VALUE '1508'.
*--1508 #01. 2015.02.02
*++1608 #01. 2015.02.01
CONSTANTS: C_1608  TYPE /ZAK/BTYPE VALUE '1608'.
*--1608 #01. 2015.02.01
*++1708 #01. 2017.01.31
CONSTANTS: C_1708  TYPE /ZAK/BTYPE VALUE '1708'.
*--1708 #01. 2017.01.31
*++PTGSZLAA #01. 2014.03.03
*CONSTANTS: C_PTGSZLAA  TYPE /ZAK/BTYPE VALUE 'PTGSZLAA'.
*--PTGSZLAA #01. 2014.03.03
*++1808 #01. 2018.01.30
CONSTANTS: C_1808  TYPE /ZAK/BTYPE VALUE '1808'.
*--1808 #01. 2018.01.30
*++1908 #01. 2019.01.29
CONSTANTS: C_1908  TYPE /ZAK/BTYPE VALUE '1908'.
*--1908 #01. 2019.01.29
*++2008 #01. 2020.01.27
CONSTANTS: C_2008  TYPE /ZAK/BTYPE VALUE '2008'.
*--2008 #01. 2020.01.27
*++2108 #01.
CONSTANTS: C_2108  TYPE /ZAK/BTYPE VALUE '2108'.
*--2108 #01.
*++2208 #01.
CONSTANTS: C_2208  TYPE /ZAK/BTYPE VALUE '2208'.
*--2208 #01.
*++2308 #01.
CONSTANTS: C_2308  TYPE /ZAK/BTYPE VALUE '2308'.
*--2308 #01.
*++2408 #01.
CONSTANTS: C_2408  TYPE /ZAK/BTYPE VALUE '2408'.
*--2408 #01.
*++2508 #01.
CONSTANTS: C_2508  TYPE /ZAK/BTYPE VALUE '2508'.
*--2508 #01.
*++2308 #09.
CONSTANTS: C_2229  TYPE /ZAK/BTYPE VALUE '2229'.
*--2308 #09.
*++ BG 2007.05.17
RANGES R_DISP_BTYPE FOR /ZAK/BEVALLB-BTYPE.
*-- BG 2007.05.17

*++ BG 2007.06.22
* Kell az összes adószám mert a 0-ás mezők kezeléséhez szükséges
DATA: I_ADOAZON_ALL LIKE /ZAK/ADOAZONLPSZ OCCURS 0 WITH HEADER LINE.
*-- BG 2007.06.22

*++ BG 2007.10.01
DATA I_BUKRS TYPE STANDARD TABLE OF /ZAK/BUKRSN INITIAL SIZE 0.
DATA W_BUKRS TYPE /ZAK/BUKRSN.
*-- BG 2007.10.01

*++ BG 2007.10.04
DATA I_IDSZ TYPE STANDARD TABLE OF /ZAK/GET_IDSZ INITIAL SIZE 0.
DATA W_IDSZ TYPE /ZAK/GET_IDSZ.
*-- BG 2007.10.04

**++BG 2008/01/14
*           Transzport miatt áthelyezve a /ZAK/MAIN_EXIT_NEW-ba
CONSTANTS:
  C_ABEVAZ_A0IC50072A TYPE /ZAK/ABEVAZ VALUE 'A0IC50072A',
  C_ABEVAZ_A0IC50073A TYPE /ZAK/ABEVAZ VALUE 'A0IC50073A',
  C_ABEVAZ_A0IC50074A TYPE /ZAK/ABEVAZ VALUE 'A0IC50074A',
  C_ABEVAZ_A0IC50075A TYPE /ZAK/ABEVAZ VALUE 'A0IC50075A',
  C_ABEVAZ_A0IC50076A TYPE /ZAK/ABEVAZ VALUE 'A0IC50076A',
  C_ABEVAZ_A0IC50077A TYPE /ZAK/ABEVAZ VALUE 'A0IC50077A'.
**--BG 2008/01/14

*++0908 2009.02.27 BG
*Önrevízió kezeléséhez
DATA V_ONREV.
*--0908 2009.02.27 BG
ENHANCEMENT-POINT /ZAK/ZAK_DATA_TELENOR SPOTS /ZAK/FUNCTIONS_ES STATIC .
